import{K as F,r as i,S as $,R as e,L as q}from"./app-Bb20fhLa.js";import{R as z,s as U}from"./Rekap-D7013Gt9.js";import{S as W}from"./SectionHeader-C3FUvTEv.js";import{S as G,C as V,a as Q,b as X}from"./CardBody-lg9YuE3z.js";import{T as Y,a as Z,b as ee,c as ae}from"./TBody-DCDAfJpD.js";import{P as te}from"./Pagination-c8IZvkDx.js";function pe({rekap:s,elements:T,hasPages:w,isFirstPage:B,hasMorePages:J,session:o}){const k=F().props,[A,D]=i.useState(!1),[re,M]=i.useState(0),[c,O]=i.useState(!1),[E,b]=i.useState(!1),[g,S]=i.useState(!1),[n,m]=i.useState(null);let v="Bulan Lalu";function I(a){try{return JSON.parse(a),!0}catch{return!1}}i.useEffect(()=>{if(c){let a=0;n.forEach(r=>{r.terkirim&&a++}),alert("Proses pengiriman selesai."),M(a),$.post("/selesai",{data:JSON.stringify(n)},{preserveState:!0,preserveScroll:!0})}},[c]);const C=()=>new Promise(a=>{const r=Math.floor(Math.random()*6+1)*1e3;setTimeout(a,r)});if(g&&(async()=>{for(let a=0;a<n.length;a++)if(!n[a].terkirim){await C();try{await U(n[a],k.waApiKey,k.caption);const r={...n[a],status:"Berhasil dikirim",terkirim:!0};m(l=>l.map((t,h)=>h===a?r:t))}catch{const l={...n[a],status:"Gagal dikirim"};m(t=>t.map((h,x)=>x===a?l:h))}}O(!0),b(!1),S(!1)})(),E&&!g){const a=n.map(r=>r.terkirim?r:{...r,status:"Mengirim..."});m(a),S(!0)}const j=()=>{n===null&&m(u),confirm("Pesan akan dikirimkan. Pastikan sudah login Whatsapp ke nomor yang akan digunakan untuk mengirim. Kirim pesan sekarang?")&&(b(!0),D(!0))},L=a=>{a.preventDefault(),_(!p)};let K=!!o.success,R=o.success?o.bulan:"Januari";const[p,_]=i.useState(K),[f,ie]=i.useState("2024 / 2025"),[d,H]=i.useState(R),y=p?`Bulan ${d} Tahun Pelajaran ${f}`:"Bulanan";let u=[],N=!0,P=0;return s.data.forEach(a=>{let r=!1;a.status=="Berhasil dikirim"&&(r=!0);const l=I(a.wa)?JSON.parse(a.wa):a.wa,t=Object.values(JSON.parse(a.values));v=Object.keys(JSON.parse(a.values))[0],u.push({...a,key:++P,bulanLalu:t[0],hasilTasmi:t[1],catatan:t[2],kitabah:t[3],ujianImror:t[4],ujianDzikir:t[5],hasilAkhir:t[6],tasmiMutqin:t[7],wa:l.wa1?l.wa1:l,terkirim:r}),typeof l!="string"&&u.push({...a,key:++P,bulanLalu:t[0],hasilTasmi:t[1],catatan:t[2],kitabah:t[3],ujianImror:t[4],ujianDzikir:t[5],hasilAkhir:t[6],tasmiMutqin:t[7],wa:l.wa2,terkirim:r})}),u=u.filter(a=>a.tahun_pelajaran===f&&a.bulan===d),u.forEach(a=>{a.status!="Berhasil dikirim"&&(N=!1)}),e.createElement(e.Fragment,null,e.createElement(q,{title:"Rekapitulasi"}),e.createElement(W,{title:`Rekapitulasi ${y}`}),e.createElement(G,null,e.createElement(V,null,e.createElement(Q,{faIcon:"pen",title:`Rekapitulasi ${y}`}),e.createElement(X,null,p?e.createElement(e.Fragment,null,!E&&e.createElement(z,{word:"nama",year:f,month:d}),e.createElement(Y,null,e.createElement(Z,null,e.createElement(ee,{columns:["Nama",v,"Hasil Tasmi","Catatan","Kitabah","Ujian Imror","Ujian Dzikir","Hasil Akhir","Tasmi Mutqin","No Whatsapp","Status"]}),e.createElement(ae,{data:n||u,k:"key",from:s.from,keys:["nama","bulanLalu","hasilTasmi","catatan","kitabah","ujianImror","ujianDzikir","hasilAkhir","tasmiMutqin","wa","status"]})),e.createElement(te,{elements:T,firstItem:s.from,lastItem:s.to,total:s.total,hasPages:w,isFirstPage:B,hasMorePages:J,prevPageUrl:s.prev_page_url,nextPageUrl:s.next_page_url,currentPage:s.current_page}),!c&&!N&&e.createElement("button",{className:"btn btn-info",onClick:j,disabled:A},"Kirim pesan"))):e.createElement(e.Fragment,null,e.createElement("form",{action:"",method:"GET"},e.createElement("div",{className:"form-group"},e.createElement("div",{className:"input-group mb-3"},e.createElement("div",{className:"input-group-append"},e.createElement("button",{disabled:!0,className:"btn btn-primary"},"Tahun Pelajaran ")),e.createElement("input",{name:"tahun_pelajaran",value:"2024 / 2025",className:"form-control",readOnly:!0}),e.createElement("div",{className:"input-group-append"},e.createElement("button",{disabled:!0,className:"btn btn-primary"},"Bulan ")),e.createElement("select",{name:"bulan",className:"form-control",onChange:a=>H(a.target.value)},e.createElement("option",{value:"Januari"},"Januari"),e.createElement("option",{value:"Februari"},"Februari"),e.createElement("option",{value:"Maret"},"Maret"),e.createElement("option",{value:"April"},"April"),e.createElement("option",{value:"Mei"},"Mei"),e.createElement("option",{value:"Juni"},"Juni"),e.createElement("option",{value:"Juli"},"Juli"),e.createElement("option",{value:"Agustus"},"Agustus"),e.createElement("option",{value:"September"},"September"),e.createElement("option",{value:"Oktober"},"Oktober"),e.createElement("option",{value:"November"},"November"),e.createElement("option",{value:"Desember"},"Desember")),e.createElement("div",{className:"input-group-append"},e.createElement("button",{type:"submit",className:"btn btn-primary",onClick:L},e.createElement("i",{className:"fa fa-check"})," PILIH"))))),"Silakan memilih Bulan dan Tahun Pelajaran lalu klik tombol 'Pilih'")))))}export{pe as default};
