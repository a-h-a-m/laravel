import{K as I,r as l,R as e,L}from"./app-Bb20fhLa.js";import{R as K,s as R}from"./Rekap-D7013Gt9.js";import{S as H}from"./SectionHeader-C3FUvTEv.js";import{S as F,C as $,a as q,b as z}from"./CardBody-lg9YuE3z.js";import{T as x,a as W,b as G,c as U}from"./TBody-DCDAfJpD.js";function te({session:u}){const d=I().props,[V,w]=l.useState(0),[o,T]=l.useState(!1),[f,E]=l.useState(!1),[b,g]=l.useState(!1),[r,m]=l.useState(null);let v="Bulan Lalu";function P(a){try{return JSON.parse(a),!0}catch{return!1}}l.useEffect(()=>{if(o){let a=0;r.forEach(n=>{n.terkirim&&a++}),alert("Proses percobaan selesai. Mohon dicek di whatsapp apakah pesan berhasil"),w(a)}},[o]);const B=()=>new Promise(a=>{const n=Math.floor(Math.random()*6+1)*1e3;setTimeout(a,n)});if(b&&(async()=>{for(let a=0;a<r.length;a++)if(!r[a].terkirim){await B();try{await R(r[a],d.waApiKey,d.caption);const n={...r[a],status:"Berhasil dikirim",terkirim:!0};m(i=>i.map((t,h)=>h===a?n:t))}catch{const i={...r[a],status:"Gagal dikirim"};m(t=>t.map((h,j)=>j===a?i:h))}}T(!0),E(!1),g(!1)})(),f&&!b){const a=r.map(n=>n.terkirim?n:{...n,status:"Mengirim..."});m(a),g(!0)}const J=()=>{r===null&&m(s),confirm("Pesan akan dikirimkan. Pastikan sudah login Whatsapp ke nomor yang akan digunakan untuk mengirim. Kirim pesan sekarang?")&&E(!0)},M=a=>{a.preventDefault(),O(!c)};let A=!!u.testing,D=u.testing?u.bulan:"Januari";const[c,O]=l.useState(A),[p,Q]=l.useState("2024 / 2025"),[k,C]=l.useState(D),S=c?`Bulan ${k} Tahun Pelajaran ${p}`:"Bulanan";let s=[],y=!0,N=0;return u.testing&&(u.testing.forEach(a=>{let n=!1;a.status=="Berhasil dikirim"&&(n=!0);const i=P(a.wa)?JSON.parse(a.wa):a.wa,t=Object.values(JSON.parse(a.values));v=Object.keys(JSON.parse(a.values))[0],s.push({...a,key:++N,bulanLalu:t[0],hasilTasmi:t[1],catatan:t[2],kitabah:t[3],ujianImror:t[4],ujianDzikir:t[5],hasilAkhir:t[6],tasmiMutqin:t[7],wa:i.wa1?i.wa1:i,terkirim:n}),typeof i!="string"&&s.push({...a,key:++N,bulanLalu:t[0],hasilTasmi:t[1],catatan:t[2],kitabah:t[3],ujianImror:t[4],ujianDzikir:t[5],hasilAkhir:t[6],tasmiMutqin:t[7],wa:i.wa2,terkirim:n})}),s=s.filter(a=>a.tahun_pelajaran===p&&a.bulan===k),s.forEach(a=>{a.status!="Berhasil dikirim"&&(y=!1)})),e.createElement(e.Fragment,null,e.createElement(L,{title:"Rekapitulasi"}),e.createElement(H,{title:`Rekapitulasi ${S}`}),e.createElement(F,null,e.createElement($,null,e.createElement(q,{faIcon:"pen",title:`Rekapitulasi ${S}`}),e.createElement(z,null,c?e.createElement(e.Fragment,null,!f&&e.createElement(K,{word:"nama",year:p,month:k,test:!0}),e.createElement(x,null,e.createElement(W,null,e.createElement(G,{columns:["Nama",v,"Hasil Tasmi","Catatan","Kitabah","Ujian Imror","Ujian Dzikir","Hasil Akhir","Tasmi Mutqin","No Whatsapp","Status"]}),e.createElement(U,{data:r||s,k:"key",from:1,keys:["nama","bulanLalu","hasilTasmi","catatan","kitabah","ujianImror","ujianDzikir","hasilAkhir","tasmiMutqin","wa","status"]})),!o&&!y&&e.createElement("button",{className:"btn btn-info",onClick:J},"Kirim pesan"))):e.createElement(e.Fragment,null,e.createElement("form",{action:"",method:"GET"},e.createElement("div",{className:"form-group"},e.createElement("div",{className:"input-group mb-3"},e.createElement("div",{className:"input-group-append"},e.createElement("button",{disabled:!0,className:"btn btn-primary"},"Tahun Pelajaran ")),e.createElement("input",{name:"tahun_pelajaran",value:"2024 / 2025",className:"form-control",readOnly:!0}),e.createElement("div",{className:"input-group-append"},e.createElement("button",{disabled:!0,className:"btn btn-primary"},"Bulan ")),e.createElement("select",{name:"bulan",className:"form-control",onChange:a=>C(a.target.value)},e.createElement("option",{value:"Januari"},"Januari"),e.createElement("option",{value:"Februari"},"Februari"),e.createElement("option",{value:"Maret"},"Maret"),e.createElement("option",{value:"April"},"April"),e.createElement("option",{value:"Mei"},"Mei"),e.createElement("option",{value:"Juni"},"Juni"),e.createElement("option",{value:"Juli"},"Juli"),e.createElement("option",{value:"Agustus"},"Agustus"),e.createElement("option",{value:"September"},"September"),e.createElement("option",{value:"Oktober"},"Oktober"),e.createElement("option",{value:"November"},"November"),e.createElement("option",{value:"Desember"},"Desember")),e.createElement("div",{className:"input-group-append"},e.createElement("button",{type:"submit",className:"btn btn-primary",onClick:M},e.createElement("i",{className:"fa fa-check"})," PILIH"))))),"Silakan memilih Bulan dan Tahun Pelajaran lalu klik tombol 'Pilih'")))))}export{te as default};
