import{K as C,r as l,R as e,L as M}from"./app-Dy5xaGAO.js";import{R,s as K}from"./Rekap-fOTjxLxZ.js";import{S as D}from"./SectionHeader-BkrGGUeA.js";import{S as F,C as $,a as H,b as I}from"./CardBody-WcVLSobK.js";import{T as x,a as L,b as W,c as Z}from"./TBody-CWxl9NsB.js";function j({session:f}){const k=C().props,[G,b]=l.useState(0),[u,J]=l.useState(!1),[h,E]=l.useState(!1),[y,v]=l.useState(!1),[n,s]=l.useState(null);function w(a){try{return JSON.parse(a),!0}catch{return!1}}l.useEffect(()=>{if(u){let a=0;n.forEach(t=>{t.terkirim&&a++}),alert("Proses percobaan selesai. Mohon dicek di whatsapp apakah pesan berhasil"),b(a)}},[u]);const T=()=>new Promise(a=>{const t=Math.floor(Math.random()*6+1)*1e3;setTimeout(a,t)});if(y&&(async()=>{for(let a=0;a<n.length;a++)if(!n[a].terkirim){await T();try{await K(n[a],k.waApiKey,k.caption);const t={...n[a],status:"Berhasil dikirim",terkirim:!0};s(r=>r.map((p,d)=>d===a?t:p))}catch{const r={...n[a],status:"Gagal dikirim"};s(p=>p.map((d,A)=>A===a?r:d))}}J(!0),E(!1),v(!1)})(),h&&!y){const a=n.map(t=>t.terkirim?t:{...t,status:"Mengirim..."});s(a),v(!0)}const B=()=>{n===null&&s(i),confirm("Pesan akan dikirimkan. Pastikan sudah login Whatsapp ke nomor yang akan digunakan untuk mengirim. Kirim pesan sekarang?")&&E(!0)},P=a=>{a.preventDefault(),O(!m)},[m,O]=l.useState(!1),[o,U]=l.useState("2024 / 2025"),[c,z]=l.useState("Januari"),S=m?`Bulan ${c} Tahun Pelajaran ${o}`:"Bulanan";let i=[],g=!0,N=0;return f.testing&&(f.testing.forEach(a=>{let t=!1;a.status=="Berhasil dikirim"&&(t=!0);const r=w(a.wa)?JSON.parse(a.wa):a.wa;i.push({...a,key:++N,ziyadah:JSON.parse(a.values).Ziyadah,total:JSON.parse(a.values)["Total Juz yang telah disetorkan"],juz:JSON.parse(a.values)["Juz Ujian Al-Qur'an Bulanan"],wa:r.wa1?r.wa1:r,terkirim:t}),typeof r!="string"&&i.push({...a,key:++N,ziyadah:JSON.parse(a.values).Ziyadah,total:JSON.parse(a.values)["Total Juz yang telah disetorkan"],juz:JSON.parse(a.values)["Juz Ujian Al-Qur'an Bulanan"],wa:r.wa2,terkirim:t})}),i=i.filter(a=>a.tahun_pelajaran===o&&a.bulan===c),i.forEach(a=>{a.status!="Berhasil dikirim"&&(g=!1)})),e.createElement(e.Fragment,null,e.createElement(M,{title:"Rekapitulasi"}),e.createElement(D,{title:`Rekapitulasi ${S}`}),e.createElement(F,null,e.createElement($,null,e.createElement(H,{faIcon:"pen",title:`Rekapitulasi ${S}`}),e.createElement(I,null,m?e.createElement(e.Fragment,null,!h&&e.createElement(R,{word:"nama",year:o,month:c,test:!0}),e.createElement(x,null,e.createElement(L,null,e.createElement(W,{columns:["Nama","Ziyadah","Total","Juz","No Whatsapp","Status"]}),e.createElement(Z,{data:n||i,k:"key",from:1,keys:["nama","ziyadah","total","juz","wa","status"]})),!u&&!g&&e.createElement("button",{className:"btn btn-info",onClick:B},"Kirim pesan"))):e.createElement(e.Fragment,null,e.createElement("form",{action:"",method:"GET"},e.createElement("div",{className:"form-group"},e.createElement("div",{className:"input-group mb-3"},e.createElement("div",{className:"input-group-append"},e.createElement("button",{disabled:!0,className:"btn btn-primary"},"Tahun Pelajaran ")),e.createElement("input",{name:"tahun_pelajaran",value:"2024 / 2025",className:"form-control",readOnly:!0}),e.createElement("div",{className:"input-group-append"},e.createElement("button",{disabled:!0,className:"btn btn-primary"},"Bulan ")),e.createElement("select",{name:"bulan",className:"form-control",onChange:a=>z(a.target.value)},e.createElement("option",{value:"Januari"},"Januari"),e.createElement("option",{value:"Februari"},"Februari"),e.createElement("option",{value:"Maret"},"Maret"),e.createElement("option",{value:"April"},"April"),e.createElement("option",{value:"Mei"},"Mei"),e.createElement("option",{value:"Juni"},"Juni"),e.createElement("option",{value:"Juli"},"Juli"),e.createElement("option",{value:"Agustus"},"Agustus"),e.createElement("option",{value:"September"},"September"),e.createElement("option",{value:"Oktober"},"Oktober"),e.createElement("option",{value:"November"},"November"),e.createElement("option",{value:"Desember"},"Desember")),e.createElement("div",{className:"input-group-append"},e.createElement("button",{type:"submit",className:"btn btn-primary",onClick:P},e.createElement("i",{className:"fa fa-check"})," PILIH"))))),"Silakan memilih Bulan dan Tahun Pelajaran lalu klik tombol 'Pilih'")))))}export{j as default};
