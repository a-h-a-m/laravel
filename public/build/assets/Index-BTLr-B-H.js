import{K as x,r as n,S as D,R as e,L as F}from"./app-DO--l6S8.js";import{R as $,s as H}from"./Rekap-CI264_s2.js";import{S as U}from"./SectionHeader-C1lVUNW7.js";import{S as L,C as W,a as Z,b as G}from"./CardBody-CIF7kO8f.js";import{T as Q,a as V,b as q,c as X}from"./TBody-DG0_WpQS.js";import{P as Y}from"./Pagination-B1XFLm2e.js";function ue({rekap:s,elements:b,hasPages:J,isFirstPage:P,hasMorePages:w}){const E=x().props,[B,T]=n.useState(!1),[j,O]=n.useState(0),[o,z]=n.useState(!1),[h,k]=n.useState(!1),[g,S]=n.useState(!1),[r,u]=n.useState(null);function A(a){try{return JSON.parse(a),!0}catch{return!1}}n.useEffect(()=>{if(o){let a=0;r.forEach(t=>{t.terkirim&&a++}),alert("Proses pengiriman selesai."),O(a),D.post("/selesai",{data:JSON.stringify(r)},{preserveState:!0,preserveScroll:!0})}},[o]);const C=()=>new Promise(a=>{const t=Math.floor(Math.random()*6+1)*1e3;setTimeout(a,t)});if(g&&(async()=>{for(let a=0;a<r.length;a++)if(!r[a].terkirim){await C();try{await H(r[a],E.waApiKey,E.caption);const t={...r[a],status:"Berhasil dikirim",terkirim:!0};u(l=>l.map((d,f)=>f===a?t:d))}catch{const l={...r[a],status:"Gagal dikirim"};u(d=>d.map((f,K)=>K===a?l:f))}}z(!0),k(!1),S(!1)})(),h&&!g){const a=r.map(t=>t.terkirim?t:{...t,status:"Mengirim..."});u(a),S(!0)}const M=()=>{r===null&&u(i),confirm("Pesan akan dikirimkan. Pastikan sudah login Whatsapp ke nomor yang akan digunakan untuk mengirim. Kirim pesan sekarang?")&&(k(!0),T(!0))},R=a=>{a.preventDefault(),_(!m)},[m,_]=n.useState(!1),[c,ae]=n.useState("2024 / 2025"),[p,I]=n.useState("Januari"),v=m?`Bulan ${p} Tahun Pelajaran ${c}`:"Bulanan";let i=[],y=!0,N=0;return s.data.forEach(a=>{let t=!1;a.status=="Berhasil dikirim"&&(t=!0);const l=A(a.wa)?JSON.parse(a.wa):a.wa;i.push({...a,key:++N,ziyadah:JSON.parse(a.values).Ziyadah,total:JSON.parse(a.values)["Total Juz yang telah disetorkan"],juz:JSON.parse(a.values)["Juz Ujian Al-Qur'an Bulanan"],wa:l.wa1?l.wa1:l,terkirim:t}),typeof l!="string"&&i.push({...a,key:++N,ziyadah:JSON.parse(a.values).Ziyadah,total:JSON.parse(a.values)["Total Juz yang telah disetorkan"],juz:JSON.parse(a.values)["Juz Ujian Al-Qur'an Bulanan"],wa:l.wa2,terkirim:t})}),i=i.filter(a=>a.tahun_pelajaran===c&&a.bulan===p),i.forEach(a=>{a.status!="Berhasil dikirim"&&(y=!1)}),e.createElement(e.Fragment,null,e.createElement(F,{title:"Rekapitulasi"}),e.createElement(U,{title:`Rekapitulasi ${v}`}),e.createElement(L,null,e.createElement(W,null,e.createElement(Z,{faIcon:"pen",title:`Rekapitulasi ${v}`}),e.createElement(G,null,m?e.createElement(e.Fragment,null,!h&&e.createElement($,{word:"nama",year:c,month:p}),e.createElement(Q,null,e.createElement(V,null,e.createElement(q,{columns:["Nama","Ziyadah","Total","Juz","No Whatsapp","Status"]}),e.createElement(X,{data:r||i,k:"key",from:s.from,keys:["nama","ziyadah","total","juz","wa","status"]})),e.createElement(Y,{elements:b,firstItem:s.from,lastItem:s.to,total:s.total,hasPages:J,isFirstPage:P,hasMorePages:w,prevPageUrl:s.prev_page_url,nextPageUrl:s.next_page_url,currentPage:s.current_page}),!o&&!y&&e.createElement("button",{className:"btn btn-info",onClick:M,disabled:B},"Kirim pesan"))):e.createElement(e.Fragment,null,e.createElement("form",{action:"",method:"GET"},e.createElement("div",{className:"form-group"},e.createElement("div",{className:"input-group mb-3"},e.createElement("div",{className:"input-group-append"},e.createElement("button",{disabled:!0,className:"btn btn-primary"},"Tahun Pelajaran ")),e.createElement("input",{name:"tahun_pelajaran",value:"2024 / 2025",className:"form-control",readOnly:!0}),e.createElement("div",{className:"input-group-append"},e.createElement("button",{disabled:!0,className:"btn btn-primary"},"Bulan ")),e.createElement("select",{name:"bulan",className:"form-control",onChange:a=>I(a.target.value)},e.createElement("option",{value:"Januari"},"Januari"),e.createElement("option",{value:"Februari"},"Februari"),e.createElement("option",{value:"Maret"},"Maret"),e.createElement("option",{value:"April"},"April"),e.createElement("option",{value:"Mei"},"Mei"),e.createElement("option",{value:"Juni"},"Juni"),e.createElement("option",{value:"Juli"},"Juli"),e.createElement("option",{value:"Agustus"},"Agustus"),e.createElement("option",{value:"September"},"September"),e.createElement("option",{value:"Oktober"},"Oktober"),e.createElement("option",{value:"November"},"November"),e.createElement("option",{value:"Desember"},"Desember")),e.createElement("div",{className:"input-group-append"},e.createElement("button",{type:"submit",className:"btn btn-primary",onClick:R},e.createElement("i",{className:"fa fa-check"})," PILIH"))))),"Silakan memilih Bulan dan Tahun Pelajaran lalu klik tombol 'Pilih'")))))}export{ue as default};
