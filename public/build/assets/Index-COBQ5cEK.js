import{a as _,r as l,m as I,R as e,K as M,S as q,L as F}from"./app-DxGV-Ihe.js";import{S as K}from"./SectionHeader-ByjmnWxZ.js";import{S as L,C as U,a as H,b as G}from"./CardBody-D85Lfz3B.js";import{T as W,a as Z,b as Q,c as V,P as Y}from"./Pagination-4gKW2bS9.js";async function X({id:n,nama:f,bulan:u,wa:h},E,m){const c=new Date().getFullYear(),p={to:h.replace(/^08/,"628"),url:`https://haspi.appdev.my.id/files/${u}-${c}-${n}.pdf`,text:m,filename:`Rekapitulasi ${u} ${c}_${f}.pdf`};try{const s=await _.post("https://api.chat-wa.com/message/send-document",p,{headers:{"x-api-key":E,"Content-Type":"application/json"}});console.log(p)}catch(s){throw console.log(s),new Error(null)}}function j({word:n,year:f,month:u}){const[h,E]=l.useState(!1),{data:m,setData:c,get:p}=I({q:null}),s=new URLSearchParams(window.location.search);s.get("q")&&!h&&(c({q:s.get("q")}),E(!0));function k(d){d.preventDefault(),p("/admin/rekap",{preserveState:!0})}return e.createElement("form",{onSubmit:k,method:"GET"},e.createElement("div",{className:"form-group"},e.createElement("div",{className:"input-group mb-3"},e.createElement("div",{className:"input-group-prepend"},e.createElement("a",{href:`/admin/rekap/create?t=${f}&b=${u}`,className:"btn btn-primary",style:{paddingTop:"10px"}},e.createElement("i",{className:"fa fa-plus-circle"})," Tambah")),e.createElement("input",{type:"text",className:"form-control",placeholder:`Cari berdasarkan ${n}`,value:m.q,onChange:d=>c("q",d.target.value)}),e.createElement("div",{className:"input-group-append"},e.createElement("button",{type:"submit",className:"btn btn-primary"},e.createElement("i",{className:"fa fa-search"})," CARI")))))}function se({rekap:n,elements:f,hasPages:u,isFirstPage:h,hasMorePages:E}){const m=M().props,[c,p]=l.useState(0),[s,k]=l.useState(!1),[d,w]=l.useState(!1),[J,P]=l.useState(!1),[r,g]=l.useState(null);function O(a){try{return JSON.parse(a),!0}catch{return!1}}l.useEffect(()=>{if(s){let a=0;r.forEach(t=>{t.terkirim&&a++}),alert("Proses pengiriman selesai."),p(a),q.post("/selesai",{data:JSON.stringify(r)},{preserveState:!0,preserveScroll:!0})}},[s]);const C=()=>new Promise(a=>{const t=Math.floor(Math.random()*6+1)*1e3;setTimeout(a,t)});if(J&&(async()=>{for(let a=0;a<r.length;a++)if(!r[a].terkirim){await C();try{await X(r[a],m.waApiKey,m.caption);const t={...r[a],status:"Berhasil dikirim",terkirim:!0};g(i=>i.map((N,b)=>b===a?t:N))}catch{const i={...r[a],status:"Gagal dikirim"};g(N=>N.map((b,D)=>D===a?i:b))}}k(!0),w(!1),P(!1)})(),d&&!J){const a=r.map(t=>t.terkirim?t:{...t,status:"Mengirim..."});g(a),P(!0)}const z=()=>{r===null&&g(o),confirm("Pesan akan dikirimkan. Pastikan sudah login Whatsapp ke nomor yang akan digunakan untuk mengirim. Kirim pesan sekarang?")&&w(!0)},x=a=>{a.preventDefault(),A(!v)},[v,A]=l.useState(!1),[y,ae]=l.useState("2024 / 2025"),[S,R]=l.useState("Januari"),T=v?`Bulan ${S} Tahun Pelajaran ${y}`:"Bulanan";let o=[],$=!0,B=0;return n.data.forEach(a=>{let t=!1;a.status=="Berhasil dikirim"&&(t=!0);const i=O(a.wa)?JSON.parse(a.wa):a.wa;o.push({...a,key:++B,ziyadah:JSON.parse(a.values).Ziyadah,total:JSON.parse(a.values)["Total Juz yang telah disetorkan"],juz:JSON.parse(a.values)["Juz Ujian Al-Qur'an Bulanan"],wa:i.wa1?i.wa1:i,terkirim:t}),typeof i!="string"&&o.push({...a,key:++B,ziyadah:JSON.parse(a.values).Ziyadah,total:JSON.parse(a.values)["Total Juz yang telah disetorkan"],juz:JSON.parse(a.values)["Juz Ujian Al-Qur'an Bulanan"],wa:i.wa2,terkirim:t})}),o=o.filter(a=>a.tahun_pelajaran===y&&a.bulan===S),o.forEach(a=>{a.status!="Berhasil dikirim"&&($=!1)}),e.createElement(e.Fragment,null,e.createElement(F,{title:"Rekapitulasi"}),e.createElement(K,{title:`Rekapitulasi ${T}`}),e.createElement(L,null,e.createElement(U,null,e.createElement(H,{faIcon:"pen",title:`Rekapitulasi ${T}`}),e.createElement(G,null,v?e.createElement(e.Fragment,null,!d&&e.createElement(j,{word:"nama",year:y,month:S}),e.createElement(W,null,e.createElement(Z,null,e.createElement(Q,{columns:["Nama","Ziyadah","Total","Juz","No Whatsapp","Status"]}),e.createElement(V,{data:r||o,k:"key",from:n.from,keys:["nama","ziyadah","total","juz","wa","status"]})),e.createElement(Y,{elements:f,firstItem:n.from,lastItem:n.to,total:n.total,hasPages:u,isFirstPage:h,hasMorePages:E,prevPageUrl:n.prev_page_url,nextPageUrl:n.next_page_url,currentPage:n.current_page}),!s&&!$&&e.createElement("button",{className:"btn btn-info",onClick:z},"Kirim pesan"))):e.createElement(e.Fragment,null,e.createElement("form",{action:"",method:"GET"},e.createElement("div",{className:"form-group"},e.createElement("div",{className:"input-group mb-3"},e.createElement("div",{className:"input-group-append"},e.createElement("button",{disabled:!0,className:"btn btn-primary"},"Tahun Pelajaran ")),e.createElement("input",{name:"tahun_pelajaran",value:"2024 / 2025",className:"form-control",readOnly:!0}),e.createElement("div",{className:"input-group-append"},e.createElement("button",{disabled:!0,className:"btn btn-primary"},"Bulan ")),e.createElement("select",{name:"bulan",className:"form-control",onChange:a=>R(a.target.value)},e.createElement("option",{value:"Januari"},"Januari"),e.createElement("option",{value:"Februari"},"Februari"),e.createElement("option",{value:"Maret"},"Maret"),e.createElement("option",{value:"April"},"April"),e.createElement("option",{value:"Mei"},"Mei"),e.createElement("option",{value:"Juni"},"Juni"),e.createElement("option",{value:"Juli"},"Juli"),e.createElement("option",{value:"Agustus"},"Agustus"),e.createElement("option",{value:"September"},"September"),e.createElement("option",{value:"Oktober"},"Oktober"),e.createElement("option",{value:"November"},"November"),e.createElement("option",{value:"Desember"},"Desember")),e.createElement("div",{className:"input-group-append"},e.createElement("button",{type:"submit",className:"btn btn-primary",onClick:x},e.createElement("i",{className:"fa fa-check"})," PILIH"))))),"Silakan memilih Bulan dan Tahun Pelajaran lalu klik tombol 'Pilih'")))))}export{se as default};
